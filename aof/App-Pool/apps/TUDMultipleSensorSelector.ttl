@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix o: <http://comvantage.eu/ontologies/iaf/2013/0/Orchestration.owl#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix adl: <http://eatld.et.tu-dresden.de/ADL#> .

## Define Input and Output blank nodes
# Inputs
_:Iparameter1 a adl:IOparameter ;
	adl:hasParameterName _:IParameterName1 ;
	adl:hasParameterType xsd:string .

_:IParameterName1 a adl:ParameterName ;
	rdfs:label "plantURI" .

# Outputs
_:Oparameter1 a adl:IOparameter ;
	adl:hasParameterName _:OParameterName1 ;
	adl:hasParameterType xsd:IDREFS .

_:OParameterName1 a adl:ParameterName ;
	rdfs:label "sensorProperties" .

## URI of the Generic App that is described
o:TUDMultipleSensorSelector-638dd3

## Add Intents
o:hasIntent	[
  o:intentPurpose	"SelectSensors";
  o:intentString	"eu.comvantage.iaf.SELECT_MULTIPLE_SENSORS"] ;

## Add Inputs and Outputs to the app

adl:hasInput [
	a adl:Input ;
	adl:hasSignature [
		a adl:Signature ;
		adl:hasIOparameter _:Iparameter1 ;
	]
] ;

adl:hasOutput [
	a adl:Output ;
	adl:hasSignature [
		a adl:Signature ;
		adl:hasIOparameter _:Oparameter1 ;
	]
] ;

## SPARQL Templates
adl:hasSparqlTemplate [
  a adl:SparqlTemplate ;
  adl:queryString
  """
  PREFIX  rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX  msem: <http://www.comvantage.eu/ontologies/mma/msem/>
  PREFIX  nasa: <http://data.nasa.gov/qudt/owl/qudt#>
  PREFIX  mso:  <http://eatld.et.tu-dresden.de/mso/>
  PREFIX  sce:  <http://eatld.et.tu-dresden.de/sce/>
  PREFIX  sensor:  <http://eatld.et.tu-dresden.de/sensor/>

  SELECT DISTINCT  ?pv ?kennzeichen ?kennzeichen_txt ?label ?continous ?unit
  WHERE
    {   { %%%plantURI%%% mso:plantID ?kennzeichen
	    { ?equipment mso:hasEquipment %%%plantURI%%% }
	  UNION
	    { ?device sce:hasEquipment %%%plantURI%%% }
	}
      UNION
	{ ?device mso:plantID ?kennzeichen }
      ?device mso:plantID ?kennzeichen .
      ?device msem:hasSimulatedSensor ?pv .
      ?device rdfs:comment ?kennzeichen_txt
      FILTER ( ( lang(?kennzeichen) = "de" ) && ( lang(?kennzeichen_txt) = "de" ) )
      ?pv rdfs:label ?label .
      ?pv sensor:continousValues ?continous
      OPTIONAL
	{ ?pv msem:hasPhysicalUnit ?u .
	  ?u nasa:abbreviation ?unit
	}
      OPTIONAL
	{ ?device mso:plantID ?kennzeichen }
      OPTIONAL
	{ ?device rdfs:comment ?kennzeichen_txt }
    }
  ORDER BY DESC(?kennzeichen_txt)
  """ ;
  adl:queryKey "getSensors" ;
  adl:queryIndex 0 ;
  adl:hasPlaceholder [
    a adl:TemplatePlaceholder ;
	rdfs:label "plantURI" ;
	adl:isDeliveredBy _:IOparameter1
	]
] 

## Final dot
.

## End of description