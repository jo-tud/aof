# APP-ENSEMBLE PREFIXES
@prefix aof: <http://eatld.et.tu-dresden.de/aof/> .

# USED ONTOLOGIES
@prefix bpmn2: <http://dkm.fbk.eu/index.php/BPMN2_Ontology#> .
@prefix dc: <http://purl.org/dc/terms/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# Namespaces for THIS App-Ensemble
@prefix jen: <http://dev.plt.et.tu-dresden.de:8085/jenkins/job/> .
@prefix play: <http://play.google.com/store/apps/details?id=> .
@prefix android: <http://schemas.android.com/apk/res/android> .

# Unique prefix for THIS App-Ensemble
@prefix ae: <http://eataof.et.tu-dresden.de/app-ensembles/5G_Example_v2#> .

# compatibility
@prefix adl: <http://#> .

# Validation with rapper: rapper -i turtle ae.ttl

# Creators
<mailto:johannes.pfeffer@tu-dresden.de>    a foaf:Person ;
        foaf:name "Johannes Pfeffer"; 
        foaf:mbox <mailto:johannes.pfeffer@tu-dresden.de>; 
        foaf:homepage <http://www.et.tu-dresden.de/ifa/index.php?id=jp> .

# APP-ENSEMBLE
## Meta
<http://eataof.et.tu-dresden.de/app-ensembles/5G_Example_v2> a aof:AppEnsemble, bpmn2:process;
    bpmn2:id "5G_Example_v2" ;
    bpmn2:name "5G-Example v2" ;

    dc:creator [
        a foaf:Person ; 
        foaf:name "Johannes Pfeffer" ; 
        foaf:mbox <mailto:johannes.pfeffer@tu-dresden.de> ; 
        foaf:homepage <http://www.et.tu-dresden.de/ifa/index.php?id=jp>
     ] ;

    dc:created "2015-03-10T08:31:57+0100" ;
    dc:modified "2015-03-10T08:31:57+0100" ;
    
    ### Is an entry point still needed whenn we use signals?
    aof:defaultEntryPoint ae:AE_Signal_1 ;
    
    ### This should only list apps that are required for the App-Ensemble to function but are not directly part of the sequence flow
    aof:requiresApp aof:IAFLogin_Zvy4kvB-fH9T,
        aof:IAFManagementComponent_ZIRiErVxZHc-,
        aof:OIFileManager_uNSUZ7-rb3mm,
        aof:TUDSimpleList_NryuJDGzjNXl,
        aof:TUDSimpleMessage_MBrh2UmSe3AP .

## Sequence Flow
### Signals
ae:Signal_1 a bpmn2:signal ;
    bpmn2:id "Signal_1" ;
    bpmn2:name "Support Choose Plant" .

### Event Definitions
ae:_MessageEventDefinition_10 a bpmn2:signalEventDefinition ;
    bpmn2:id "_MessageEventDefinition_10" ;
    bpmn2:has_signalRef "Signal_1" .

### Sequence flows
ae:SequenceFlow_1 a bpmn2:sequenceFlow ;
    bpmn2:id "SequenceFlow_1" ;
    bpmn2:has_sourceRef ae:AE_Signal_1 ;
    bpmn2:has_targetRef ae:PlantBrowser_1 .

### Signal catcher
ae:AE_Signal_1 a bpmn2:startEvent ;
    bpmn2:id "AE_Signal_1" ;
    bpmn2:outgoing ae:SequenceFlow_1 ;
    bpmn2:has_eventDefinition ae:_MessageEventDefinition_10 .

### Service Tasks
### These Tasks realize the App-Ensemble
ae:PlantBrowser_1 a bpmn2:serviceTask ;
    bpmn2:id "PlantBrowser_1" ;
    bpmn2:name "Plant Browser" ;
    aof:associatedApp jen:TUDPlantSelector .
#If there are restrictions on the Version of the app that shall be used:    
#aof:minVersion, aof:maxVersion, aof:exactVersion
    

# APPS
## Conductor App
jen:AOFConductor
    a aof:App, aof:AndroidApp ;
    aof:hasRole aof:Conductor ;
    
    aof:MainScreenshot [
        aof:hasScreenshot <http://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Steven_Sametz_conducting%2C_cropped.jpg/256px-Steven_Sametz_conducting%2C_cropped.jpg> ;
        aof:hasScreenshotThumbnail <http://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Steven_Sametz_conducting%2C_cropped.jpg/256px-Steven_Sametz_conducting%2C_cropped.jpg> ;
        rdfs:comment "Main Screenshot"
    ] ;
    aof:Screenshot [
        aof:hasScreenshot <http://upload.wikimedia.org/wikipedia/commons/thumb/1/17/Full_score.jpg/320px-Full_score.jpg> ;
        aof:hasScreenshotThumbnail <http://upload.wikimedia.org/wikipedia/commons/thumb/1/17/Full_score.jpg/320px-Full_score.jpg>
     ] ;
    aof:Screenshot [
        aof:hasScreenshot <http://upload.wikimedia.org/wikipedia/commons/2/2f/Bundesarchiv_Bild_183-R92264%2C_Herbert_von_Karajan.jpg> ;
        aof:hasScreenshotThumbnail <http://upload.wikimedia.org/wikipedia/commons/2/2f/Bundesarchiv_Bild_183-R92264%2C_Herbert_von_Karajan.jpg> 
     ] ;

    aof:hasIcon aof:hasIcon </static/img/logo_aof_small.png> ;

    dc:creator [
        a foaf:Person ;
        foaf:name "Johannes Pfeffer" ;
        foaf:mbox <mailto:johannes.pfeffer@tu-dresden.de> ;
        foaf:homepage <http://www.et.tu-dresden.de/ifa/index.php?id=jp>
     ] ;

    rdfs:label "AOF Conductor" ;
    rdfs:comment
        """
        The *AOF Conductor* is an app that executes App-Ensembles on Android mobile devices.
        """ ;
    ### Entry points
    aof:providesEntryPoint [
        a aof:EntryPoint, android:action ;
        android:name "org.aof.action.START_WORKFLOW" ;
        rdfs:label "Start Workflow" ;
        rdfs:comment
            """
            When called with no extras, the *StartWorkflow* action brings up an activity that enables the user to choose an App-Ensemble from the file system. When the *org.aof.extra.AE_FILE* extra is provided, the App-Ensemble is loaded immediately.
            """ ;
        aof:hasInput [
            a aof:Input, android:extra ;
            aof:isRequired "False";
            android:name "org.aof.extra.AE_FILE";
            aof:datatype xsd:anyURI 
         ]
     ] ;

    aof:providesEntryPoint [
        a aof:EntryPoint, android:action ;
        android:name "android.intent.action.MAIN" ;
        rdfs:label "Main entry point" ;
        rdfs:comment
            """
           This activity is the entry point for the application when it is used stand-alone. It does not expect to receive data.
            """ ;
     ] ;
    
    aof:hasAppDependency play:org.openintents.filemanager .

### Additional statements
### Which is better?
play:org.openintents.filemanager owl:sameAs <http://openintents.org/~oi/filemanager> .
play:org.openintents.filemanager rdfs:seeAlso <http://openintents.org/~oi/filemanager> .

jen:TUDPlantSelector
    a aof:App, aof:AndroidApp ;
    
    dc:creator [
        a foaf:Person ;
        foaf:name "Johannes Pfeffer" ;
        foaf:mbox <mailto:johannes.pfeffer@tu-dresden.de> ;
        foaf:homepage <http://www.et.tu-dresden.de/ifa/index.php?id=jp>
     ] ;

    rdfs:label "AOF Conductor" ;
    rdfs:comment
        """
        The *AOF Conductor* is an app that executes App-Ensembles on Android mobile devices.
        """ ;
    ### Entry points
    aof:providesEntryPoint [
        a aof:EntryPoint, android:action ;
        android:name "org.aof.action.START_WORKFLOW" ;
        rdfs:label "Start Workflow" ;
        rdfs:comment
            """
            When called with no extras, the *StartWorkflow* action brings up an activity that enables the user to choose an App-Ensemble from the file system. When the *org.aof.extra.AE_FILE* extra is provided, the App-Ensemble is loaded immediately.
            """ ;
        aof:hasInput [
            a aof:Input, android:extra ;
            aof:isRequired "False";
            android:name "org.aof.extra.AE_FILE";
            aof:datatype xsd:anyURI 
         ]
     ] ;

    aof:providesEntryPoint [
        a aof:EntryPoint, android:action ;
        android:name "android.intent.action.MAIN" ;
        rdfs:label "Main entry point" ;
        rdfs:comment
            """
           This activity is the entry point for the application when it is used stand-alone. It does not expect to receive data.
            """ ;
     ] ;
    
    aof:hasAppDependency play:org.openintents.filemanager .

aof:PlantSelection_Nov_06 aof:hasIntent [ aof:intentPurpose "PlantSelection" ;
            aof:intentString "eu.comvantage.kua.launch.PLANTSELECTION" ] .

aof:TUDBaracodaTagReader_O0IrefiXKpdX aof:hasIntent [ aof:intentPurpose "Read an RFID tag" ;
            aof:intentString "eu.comvantage.iaf.READ_TAG" ] ;
    aof:requiresApp aof:BaracodaManager-9sfLOr .

aof:TUDLiveDataViewer-55lckd aof:hasIntent [ aof:intentPurpose "ViewLiveData" ;
            aof:intentString "eu.comvantage.iaf.VIEW_LIVE_DATA" ] ;
    adl:hasInput [ a adl:Input ;
            adl:hasSignature [ a adl:Signature ;
                    adl:hasIOparameter [ a adl:IOparameter ;
                            adl:hasParameterName [ a adl:ParameterName ;
                                    rdfs:label "sensorProperties" ] ;
                            adl:hasParameterType xsd:IDREFS ] ] ] ;
    adl:hasOutput [ 
        adl:hasSignature [ 
            adl:hasIOparameter [ 
                adl:hasParameterName [ 
                    rdfs:label "sensorProperties" 
                 ] ;
                adl:hasParameterType xsd:IDREFS 
             ] 
         ] 
     ] ;

    adl:hasSparqlTemplate [ a adl:SparqlTemplate ;
            adl:hasPlaceholder [ a adl:TemplatePlaceholder ;
                    rdfs:label "sensorURI" ] ;
            adl:queryIndex 0 ;
            adl:queryKey "sensorQuery" ;
            adl:queryString """
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>  
  PREFIX msem: <http://www.comvantage.eu/ontologies/mma/msem/> 
  PREFIX nasa: <http://data.nasa.gov/qudt/owl/qudt#> 

  SELECT ?uri 
  WHERE 
  { 
	  %%%sensorURI%%%  msem:transientDataQueryUri ?uri .
  }
  """ ],
        [ a adl:SparqlTemplate ;
            adl:queryIndex 1 ;
            adl:queryKey "dataQuery" ;
            adl:queryString """
  PREFIX voc: <http://www.comvantage.eu/ontologies/pec/voc/> 

  SELECT ?time ?value
  WHERE 
  {
	  ?x voc:refTime ?time. ?x voc:value ?value. 
  }
  """ ] .

aof:TUDMultipleSensorSelector-638dd3 aof:hasIntent [ aof:intentPurpose "SelectSensors" ;
            aof:intentString "eu.comvantage.iaf.SELECT_MULTIPLE_SENSORS" ] ;
    adl:hasInput [ a adl:Input ;
            adl:hasSignature [ a adl:Signature ;
                    adl:hasIOparameter [ a adl:IOparameter ;
                            adl:hasParameterName [ a adl:ParameterName ;
                                    rdfs:label "plantURI" ] ;
                            adl:hasParameterType xsd:string ] ] ] ;
    adl:hasOutput [ a adl:Output ;
            adl:hasSignature [ a adl:Signature ;
                    adl:hasIOparameter [ a adl:IOparameter ;
                            adl:hasParameterName [ a adl:ParameterName ;
                                    rdfs:label "sensorProperties" ] ;
                            adl:hasParameterType xsd:IDREFS ] ] ] ;
    adl:hasSparqlTemplate [ a adl:SparqlTemplate ;
            adl:hasPlaceholder [ a adl:TemplatePlaceholder ;
                    rdfs:label "plantURI" ;
                    adl:isDeliveredBy [ ] ] ;
            adl:queryIndex 0 ;
            adl:queryKey "getSensors" ;
            adl:queryString """
  PREFIX  rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX  msem: <http://www.comvantage.eu/ontologies/mma/msem/>
  PREFIX  nasa: <http://data.nasa.gov/qudt/owl/qudt#>
  PREFIX  msaof:  <http://eatld.et.tu-dresden.de/mso/>
  PREFIX  sce:  <http://eatld.et.tu-dresden.de/sce/>
  PREFIX  sensor:  <http://eatld.et.tu-dresden.de/sensor/>

  SELECT DISTINCT  ?pv ?kennzeichen ?kennzeichen_txt ?label ?continous ?unit
  WHERE
    {   { %%%plantURI%%% msaof:plantID ?kennzeichen
	    { ?equipment msaof:hasEquipment %%%plantURI%%% }
	  UNION
	    { ?device sce:hasEquipment %%%plantURI%%% }
	}
      UNION
	{ ?device msaof:plantID ?kennzeichen }
      ?device msaof:plantID ?kennzeichen .
      ?device msem:hasSimulatedSensor ?pv .
      ?device rdfs:comment ?kennzeichen_txt
      FILTER ( ( lang(?kennzeichen) = "de" ) && ( lang(?kennzeichen_txt) = "de" ) )
      ?pv rdfs:label ?label .
      ?pv sensor:continousValues ?continous
      OPTIONAL
	{ ?pv msem:hasPhysicalUnit ?u .
	  ?u nasa:abbreviation ?unit
	}
      OPTIONAL
	{ ?device msaof:plantID ?kennzeichen }
      OPTIONAL
	{ ?device rdfs:comment ?kennzeichen_txt }
    }
  ORDER BY DESC(?kennzeichen_txt)
  """ ] .

aof:TUDPlantSelector-MuyHcC aof:hasIntent [ aof:intentPurpose "SelectPlant" ;
            aof:intentString "eu.comvantage.iaf.SELECT_PLANT" ] ;
    adl:hasOutput [ a adl:Output ;
            adl:hasSignature [ a adl:Signature ;
                    adl:hasIOparameter [ a adl:IOparameter ;
                            adl:hasParameterName [ a adl:ParameterName ;
                                    rdfs:label "plantURI" ] ;
                            adl:hasParameterType xsd:string ] ] ] .






aof:OIFileManager_uNSUZ7-rb3mm a aof:ExternalApp ;
    aof:hasIntent [ aof:intentPurpose "OpenFile" ;
            aof:intentString "eu.comvantage.iaf.START_WORKFLOW" ] .

aof:TUDNeighbourhoodBrowser_vLrNh8IcwZcy aof:hasIntent [ aof:intentPurpose "Browse neighbourhood of POI" ;
            aof:intentString "eu.comvantage.iaf.NEW_TAG" ],
        [ aof:intentPurpose "Browse neighbourhood of POI" ;
            aof:intentString "eu.comvantage.iaf.NEW_TAG" ] ;
    aof:requiresApp aof:TUDBaracodaTagReader_O0IrefiXKpdX .

aof:TUDTaskReport-KuoLzZ aof:hasIntent [ aof:intentPurpose "Send task report" ;
            aof:intentString "eu.comvantage.iaf.SEND_REPORT" ],
        [ aof:intentPurpose "Send task report" ;
            aof:intentString "eu.comvantage.iaf.SEND_REPORT" ] .

