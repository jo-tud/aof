# APP-ENSEMBLE PREFIXES
@prefix aof: <http://eatld.et.tu-dresden.de/aof/> .
@prefix jen: <http://dev.plt.et.tu-dresden.de:8085/jenkins/job/> .
@prefix play: <http://play.google.com/store/apps/details?id=> .
@prefix android: <http://schemas.android.com/apk/res/android> .

# USED ONTOLOGIES

@prefix dc: <http://purl.org/dc/terms/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# Namespace for THIS App-Ensemble
@prefix ae: <http://eatld.et.tu-dresden.de/aof/AppEnsembles/5G_Example_v2> .

# Validation with rapper: rapper -i turtle ae.ttl

# Creator JP
_:JP    a foaf:Person,
        foaf:name "Johannes Pfeffer",
        foaf:mbox <mailto:johannes.pfeffer@tu-dresden.de>,
        foaf:homepage <http://www.et.tu-dresden.de/ifa/index.php?id=jp>

# App-Ensemble Definition
ae: a aof:AppEnsemble, bpmn2:Process;
    rdfs:label "5G-Example v2" ;

    dc:creator <mailto:johannes.pfeffer@tu-dresden.de> [
        a foaf:Person,
        foaf:name "Johannes Pfeffer"
        foaf:mbox <mailto:johannes.pfeffer@tu-dresden.de>,
        foaf:homepage <http://www.et.tu-dresden.de/ifa/index.php?id=jp>
     ] ;

    dc:created "2015-03-10T08:31:57+0100" ;
    dc:modified "2015-03-10T08:31:57+0100" ;
    
    aof:entryPoint _:TUDPlantSelector_1 ;

    aof:requiresApp aof:IAFLogin_Zvy4kvB-fH9T,
        aof:IAFManagementComponent_ZIRiErVxZHc-,
        aof:OIFileManager_uNSUZ7-rb3mm,
        aof:TUDSimpleList_NryuJDGzjNXl,
        aof:TUDSimpleMessage_MBrh2UmSe3AP .


# Service Tasks
ae:ServiceTask_1 a bpmn2:ServiceTask ;
    rdfs:label 
    bpmn2:incoming ae:SequenceFlow_1 ;
    bpmn2:outgoing ae:SequenceFlow_2 ;
    

# APPS
## Conductor App
jen:AOFConductor
    a aof:App, aof:AndroidApp;
    aof:hasRole aof:Conductor ;
    
    dc:creator [
        a foaf:Person,
        foaf:firstName "Johannes",
        foaf:familyName "Pfeffer",
        foaf:mbox "johannes.pfeffer@tu-dresden.de"
     ] ;

    rdfs:label "AOF Conductor" ;
    rdfs:comment
        """
        The *AOF Conductor* is an app that executes App-Ensembles on Android mobile devices.
        """ ;
    ### Entry points
    aof:providesEntryPoint [
        a aof:EntryPoint, android:action ;
        android:name "org.aof.action.START_WORKFLOW" ;
        rdfs:label "Start Workflow" ;
        rdfs:comment
            """
            When called with no extras, the *StartWorkflow* action brings up an activity that enables the user to choose an App-Ensemble from the file system. When the *org.aof.extra.AE_FILE* extra is provided, the App-Ensemble is loaded immediately.
            """ ;
        aof:hasInput [
            a aof:Input, android:extra ;
            aof:isRequired "False";
            android:name "org.aof.extra.AE_FILE"
         ]
     ] ;

    aof:providesEntryPoint [
        a aof:EntryPoint, android:action ;
        android:name "android.intent.action.MAIN" ;
        rdfs:label "Main entry point" ;
        rdfs:comment
            """
           This activity is the entry point for the application when it is used stand-alone. It does not expect to receive data.
            """ ;
     ] ;

    aof:requiresApp play:org.openintents.filemanager .

### Additional statements
### Which is better?
play:org.openintents.filemanager owl:sameAs <http://openintents.org/~oi/filemanager> .
play:org.openintents.filemanager rdf:seeAlso <http://openintents.org/~oi/filemanager> .


aof:PlantSelection_Nov_06 aof:hasIntent [ aof:intentPurpose "PlantSelection" ;
            aof:intentString "eu.comvantage.kua.launch.PLANTSELECTION" ] .

aof:TUDBaracodaTagReader_O0IrefiXKpdX aof:hasIntent [ aof:intentPurpose "Read an RFID tag" ;
            aof:intentString "eu.comvantage.iaf.READ_TAG" ] ;
    aof:requiresApp aof:BaracodaManager-9sfLOr .

aof:TUDLiveDataViewer-55lckd aof:hasIntent [ aof:intentPurpose "ViewLiveData" ;
            aof:intentString "eu.comvantage.iaf.VIEW_LIVE_DATA" ] ;
    adl:hasInput [ a adl:Input ;
            adl:hasSignature [ a adl:Signature ;
                    adl:hasIOparameter [ a adl:IOparameter ;
                            adl:hasParameterName [ a adl:ParameterName ;
                                    rdfs:label "sensorProperties" ] ;
                            adl:hasParameterType xsd:IDREFS ] ] ] ;
    adl:hasOutput [ a adl:Output ;
            adl:hasSignature [ a adl:Signature ;
                    adl:hasIOparameter [ a adl:IOparameter ;
                            adl:hasParameterName [ a adl:ParameterName ;
                                    rdfs:label "sensorProperties" ] ;
                            adl:hasParameterType xsd:IDREFS ] ] ] ;
    adl:hasSparqlTemplate [ a adl:SparqlTemplate ;
            adl:hasPlaceholder [ a adl:TemplatePlaceholder ;
                    rdfs:label "sensorURI" ] ;
            adl:queryIndex 0 ;
            adl:queryKey "sensorQuery" ;
            adl:queryString """
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>  
  PREFIX msem: <http://www.comvantage.eu/ontologies/mma/msem/> 
  PREFIX nasa: <http://data.nasa.gov/qudt/owl/qudt#> 

  SELECT ?uri 
  WHERE 
  { 
	  %%%sensorURI%%%  msem:transientDataQueryUri ?uri .
  }
  """ ],
        [ a adl:SparqlTemplate ;
            adl:queryIndex 1 ;
            adl:queryKey "dataQuery" ;
            adl:queryString """
  PREFIX voc: <http://www.comvantage.eu/ontologies/pec/voc/> 

  SELECT ?time ?value
  WHERE 
  {
	  ?x voc:refTime ?time. ?x voc:value ?value. 
  }
  """ ] .

aof:TUDMultipleSensorSelector-638dd3 aof:hasIntent [ aof:intentPurpose "SelectSensors" ;
            aof:intentString "eu.comvantage.iaf.SELECT_MULTIPLE_SENSORS" ] ;
    adl:hasInput [ a adl:Input ;
            adl:hasSignature [ a adl:Signature ;
                    adl:hasIOparameter [ a adl:IOparameter ;
                            adl:hasParameterName [ a adl:ParameterName ;
                                    rdfs:label "plantURI" ] ;
                            adl:hasParameterType xsd:string ] ] ] ;
    adl:hasOutput [ a adl:Output ;
            adl:hasSignature [ a adl:Signature ;
                    adl:hasIOparameter [ a adl:IOparameter ;
                            adl:hasParameterName [ a adl:ParameterName ;
                                    rdfs:label "sensorProperties" ] ;
                            adl:hasParameterType xsd:IDREFS ] ] ] ;
    adl:hasSparqlTemplate [ a adl:SparqlTemplate ;
            adl:hasPlaceholder [ a adl:TemplatePlaceholder ;
                    rdfs:label "plantURI" ;
                    adl:isDeliveredBy [ ] ] ;
            adl:queryIndex 0 ;
            adl:queryKey "getSensors" ;
            adl:queryString """
  PREFIX  rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX  msem: <http://www.comvantage.eu/ontologies/mma/msem/>
  PREFIX  nasa: <http://data.nasa.gov/qudt/owl/qudt#>
  PREFIX  msaof:  <http://eatld.et.tu-dresden.de/mso/>
  PREFIX  sce:  <http://eatld.et.tu-dresden.de/sce/>
  PREFIX  sensor:  <http://eatld.et.tu-dresden.de/sensor/>

  SELECT DISTINCT  ?pv ?kennzeichen ?kennzeichen_txt ?label ?continous ?unit
  WHERE
    {   { %%%plantURI%%% msaof:plantID ?kennzeichen
	    { ?equipment msaof:hasEquipment %%%plantURI%%% }
	  UNION
	    { ?device sce:hasEquipment %%%plantURI%%% }
	}
      UNION
	{ ?device msaof:plantID ?kennzeichen }
      ?device msaof:plantID ?kennzeichen .
      ?device msem:hasSimulatedSensor ?pv .
      ?device rdfs:comment ?kennzeichen_txt
      FILTER ( ( lang(?kennzeichen) = "de" ) && ( lang(?kennzeichen_txt) = "de" ) )
      ?pv rdfs:label ?label .
      ?pv sensor:continousValues ?continous
      OPTIONAL
	{ ?pv msem:hasPhysicalUnit ?u .
	  ?u nasa:abbreviation ?unit
	}
      OPTIONAL
	{ ?device msaof:plantID ?kennzeichen }
      OPTIONAL
	{ ?device rdfs:comment ?kennzeichen_txt }
    }
  ORDER BY DESC(?kennzeichen_txt)
  """ ] .

aof:TUDPlantSelector-MuyHcC aof:hasIntent [ aof:intentPurpose "SelectPlant" ;
            aof:intentString "eu.comvantage.iaf.SELECT_PLANT" ] ;
    adl:hasOutput [ a adl:Output ;
            adl:hasSignature [ a adl:Signature ;
                    adl:hasIOparameter [ a adl:IOparameter ;
                            adl:hasParameterName [ a adl:ParameterName ;
                                    rdfs:label "plantURI" ] ;
                            adl:hasParameterType xsd:string ] ] ] .

aof:TUDSimpleList_NryuJDGzjNXl aof:hasIntent [ aof:intentPurpose "ShowSimpleList" ;
            aof:intentString "eu.comvantage.iaf.SIMPLE_LIST" ],
        [ aof:intentPurpose "ShowDecision" ;
            aof:intentString "eu.comvantage.iaf.DECISION" ] .

aof:TUDSimpleMessage_MBrh2UmSe3AP aof:hasIntent [ aof:intentPurpose "ShowSimpleMessage" ;
            aof:intentString "eu.comvantage.iaf.SIMPLE_MESSAGE" ] .

<http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477214-Choose_Sensors> a aof:App,
        aof:AppRequest,
        aof:SelectedApp,
        <http://www.comvantage.eu/mm#Mobile_IT_support_feature_G> ;
    aof:AppRequestName "Sensor selector" ;
    aof:DisplayName "Choose Sensors" ;
    aof:Name "Choose Sensors" ;
    aof:hasSuccessionType aof:OR ;
    aof:hasSuccessor <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477217-View_live_data>,
        <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477220-View_historical_data> ;
    aof:instanceOf aof:TUDMultipleSensorSelector-638dd3 .

<http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477223-Write_historical_data_report> a aof:App,
        aof:AppRequest,
        aof:SelectedApp,
        <http://www.comvantage.eu/mm#Mobile_IT_support_feature_G> ;
    aof:AppRequestName "Report sender" ;
    aof:DisplayName "Write historical data report" ;
    aof:Name "Write historical data report" ;
    aof:hasSuccessionType aof:OR ;
    aof:hasSuccessor <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477207-Choose_Plant> ;
    aof:instanceOf aof:TUDTaskReport-KuoLzZ .

<http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477226-Write_live_data_report> a aof:App,
        aof:AppRequest,
        aof:SelectedApp,
        <http://www.comvantage.eu/mm#Mobile_IT_support_feature_G> ;
    aof:AppRequestName "Report sender" ;
    aof:DisplayName "Write live data report" ;
    aof:Name "Write live data report" ;
    aof:hasSuccessionType aof:OR ;
    aof:hasSuccessor <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477207-Choose_Plant> ;
    aof:instanceOf aof:TUDTaskReport-KuoLzZ .

<http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477229-Choose_Sensors_with_NBB> a aof:App,
        aof:AppRequest,
        aof:SelectedApp,
        <http://www.comvantage.eu/mm#Mobile_IT_support_feature_G> ;
    aof:AppRequestName "NBB" ;
    aof:DisplayName "Choose Sensors with NBB" ;
    aof:Name "Choose Sensors with NBB" ;
    aof:hasSuccessionType aof:OR ;
    aof:hasSuccessor <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477217-View_live_data>,
        <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477220-View_historical_data> ;
    aof:instanceOf aof:TUDNeighbourhoodBrowser_vLrNh8IcwZcy .

<http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477232-Browse_Neighbourhood> a aof:App,
        aof:AppRequest,
        aof:SelectedApp,
        <http://www.comvantage.eu/mm#Mobile_IT_support_feature_G> ;
    aof:AppRequestName "NBB" ;
    aof:DisplayName "Browse Neighbourhood" ;
    aof:Name "Browse Neighbourhood" ;
    aof:hasSuccessionType aof:OR ;
    aof:hasSuccessor <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477217-View_live_data> ;
    aof:instanceOf aof:TUDNeighbourhoodBrowser_vLrNh8IcwZcy .

aof:OIFileManager_uNSUZ7-rb3mm a aof:ExternalApp ;
    aof:hasIntent [ aof:intentPurpose "OpenFile" ;
            aof:intentString "eu.comvantage.iaf.START_WORKFLOW" ] .

aof:TUDNeighbourhoodBrowser_vLrNh8IcwZcy aof:hasIntent [ aof:intentPurpose "Browse neighbourhood of POI" ;
            aof:intentString "eu.comvantage.iaf.NEW_TAG" ],
        [ aof:intentPurpose "Browse neighbourhood of POI" ;
            aof:intentString "eu.comvantage.iaf.NEW_TAG" ] ;
    aof:requiresApp aof:TUDBaracodaTagReader_O0IrefiXKpdX .

aof:TUDTaskReport-KuoLzZ aof:hasIntent [ aof:intentPurpose "Send task report" ;
            aof:intentString "eu.comvantage.iaf.SEND_REPORT" ],
        [ aof:intentPurpose "Send task report" ;
            aof:intentString "eu.comvantage.iaf.SEND_REPORT" ] .

<http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477220-View_historical_data> a aof:App,
        aof:AppRequest,
        aof:SelectedApp,
        <http://www.comvantage.eu/mm#Mobile_IT_support_feature_G> ;
    aof:AppRequestName "Historical data viewer" ;
    aof:DisplayName "View historical data" ;
    aof:Name "View historical data" ;
    aof:hasSuccessionType aof:OR ;
    aof:hasSuccessor <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477207-Choose_Plant>,
        <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477223-Write_historical_data_report> ;
    aof:instanceOf aof:PlantSelection_Nov_06 .

<http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477217-View_live_data> a aof:App,
        aof:AppRequest,
        aof:SelectedApp,
        <http://www.comvantage.eu/mm#Mobile_IT_support_feature_G> ;
    aof:AppRequestName "Live data viewer" ;
    aof:DisplayName "View live data" ;
    aof:Name "View live data" ;
    aof:hasSuccessionType aof:OR ;
    aof:hasSuccessor <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477207-Choose_Plant>,
        <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477226-Write_live_data_report>,
        <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477232-Browse_Neighbourhood> ;
    aof:instanceOf aof:TUDLiveDataViewer-55lckd .

<http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477207-Choose_Plant> a aof:App,
        aof:AppRequest,
        aof:SelectedApp,
        <http://www.comvantage.eu/mm#Mobile_IT_support_feature_G> ;
    aof:AppRequestName "Plant Browser" ;
    aof:DisplayName "Choose Plant" ;
    aof:Name "Choose Plant" ;
    aof:hasSuccessionType aof:OR ;
    aof:hasSuccessor <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477214-Choose_Sensors>,
        <http://www.comvantage.eu/models/Mobile_IT_support_feature_G-477229-Choose_Sensors_with_NBB> ;
    aof:instanceOf aof:TUDPlantSelector-MuyHcC .



